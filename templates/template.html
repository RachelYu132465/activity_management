<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ (eventNames[0] if eventNames) or "手冊" }}</title>

    <style>
        /* --- 印刷基礎（單一 @page，含註解說明） --- */
        /* If you want trim-only (no bleed), use 210mm x 297mm.
           If you include bleed, use 216mm x 303mm and adjust margins accordingly. */
        @page {
          size: 210mm 297mm;   /* trim size: A4 */
          margin: 18mm;        /* 印內邊距 */
        }

        /* 共用 reset */
        html, body { margin: 0; padding: 0; -webkit-print-color-adjust: exact; -webkit-font-smoothing:antialiased; }
        body {
          font-family: "Microsoft JhengHei", "Microsoft JhengHei UI", "PingFang TC", "Noto Sans TC", "Helvetica Neue", Arial, "Segoe UI", sans-serif;
          color: #111;
          padding: 12mm; /* preview padding on screen */
          box-sizing: border-box;
        }

        /* print tweaks: smaller content padding when printing */
        @media print {
          body { padding: 6mm; }
        }

        /* ---------- page container ---------- */
        .page-full {
          overflow: visible;
          page-break-after: always;
          page-break-inside: avoid;
          /* A4 height (297mm) minus top+bottom margins (18mm*2 = 36mm) */
          min-height: calc(297mm - 36mm);
          display: flex;
          flex-direction: column;
          justify-content: space-evenly;
          padding-top: 20mm;
          padding-bottom: 10mm;
          box-sizing: border-box;
        }
        .page-full:last-child { page-break-after: auto; }

        /* cover 封面樣式（以 page-full.cover 為定位參考） */
        .cover { text-align: center; display:flex; flex-direction:column; justify-content:flex-start; box-sizing: border-box; position: relative; }
        .page-full.cover .title {
          font-size: 28pt;
          font-weight: 700;
          width: calc(210mm - 60mm);
          max-width: calc(210mm - 20mm);
          box-sizing: border-box;
          padding: 0 6mm;
          text-align: center;
          z-index: 5;
          word-wrap: break-word;
          position: absolute;
          left: 50%;
          top: 40%;                /* 更穩定的位置 */
          transform: translateX(-50%);
          line-height: 1.6;
        }

        .inner-text { font-size: 14pt; font-weight: 700; }

        /* spacer：把參與單位推到底（數字越大越靠底） */
        .cover .spacer { flex: 1 1 auto; } /* 調整為 3 會更靠底 */

        .participation {
          margin-top: 12px;
          align-self: flex-start;
          text-align: left;
          width: 100%;
          box-sizing: border-box;
          padding-left: 6mm;
          padding-right: 12mm;
        }
        .participation p { margin: 4px 0; }

        /* 分隔線（頁內使用） */
        hr.section-sep { border: 0; height: 1px; background: #f0a500; margin: 16px 0; }

        /* 論壇資訊 / 議程 */
        .forum-info p { margin: 6px 0; }
        .notes ul { margin: 6px 0 0 18px; }

        table.schedule { border-collapse: collapse; margin-top: 8px; width: 100%; box-sizing: border-box; }
        table.schedule th, table.schedule td {
          border: 1px solid #ddd; padding: 6px 8px; vertical-align: top; font-size: 11pt;
        }
        table.schedule th { background: #f3f3f3; font-weight: 600; text-align: left; }

        .person-list { list-style: none; padding: 0; margin: 0; }
        .person-list li { margin-bottom: 6px; }

        /* person card */
        .person-card { overflow: auto; }
        .person-photo { float: right; width: 120px; margin-left: 18px; }
        .person-info .name-title { font-size: 18pt; font-weight: 700; margin-bottom: 4px; }
        .person-info .organization { font-size: 14pt; margin-bottom: 8px; }
        .person-info h3 { font-size: 16pt; margin: 8px 0 4px; }
        .person-info .section-content { font-size: 14pt; }
        .person-info ul.section-content { margin: 0 0 0 20px; padding-left: 0; }

        footer.small { font-size: 10pt; color: #666; margin-top: 10mm; text-align: left; }

        /* trim preview box（僅供預覽） */
        .trim-box {
          width: 210mm;
          height: 297mm;
          margin: 3mm auto;
          box-sizing: border-box;
          outline: 0.5pt dashed rgba(0,0,0,0.05);
        }

        .safe { padding: 8mm; }
        img { max-width: 100%; height: auto; }
    </style>
</head>

<body>
{% set section = section or 'all' %}

{% if section in ['all', 'cover'] %}
<div class="page-full cover">
    {% if assets.logo_url is defined and assets.logo_url %}
    <img src="{{ assets.logo_url }}" alt="logo" style="max-height:90px; margin-bottom:8px;">
    {% endif %}

    <div class="title">{{ eventNames[0] }}</div>

    <div class="spacer"></div>

    <div class="participation inner-text" aria-label="參與單位">
        {% if instructors is defined and instructors|length %}
        <p>指導單位：{{ instructors | join('、') }}</p>
        {% endif %}
        {% if organizers is defined and organizers|length %}
        <p>主辦單位：{{ organizers | join('、') }}</p>
        {% endif %}
        {% if jointOrganizers is defined and jointOrganizers|length %}
        <p>合辦單位：{{ jointOrganizers | join('、') }}</p>
        {% endif %}
        {% if coOrganizers is defined and coOrganizers|length %}
        <p>協辦單位：{{ coOrganizers | join('、') }}</p>
        {% endif %}

        <div>
            <span class="inner-text">日期：</span>
            <span class="inner-text js-date" data-iso="{{ date }}">{{ date }}</span>
        </div>

        <div>
            <p>地點：{{ locations[0] }}{% if locations|length > 1 %}（{{ locations[1] }}）{% endif %}</p>
        </div>
    </div>
</div>
{% endif %}

{% if section in ['all', 'notes'] %}
<section class="page-full notes" aria-label="論壇須知 Notes">
    <h2>論壇須知 / Notes</h2>
    <hr class="section-sep">
    <ul>
        <li>本次活動報到時間為上午09:30-10:00。</li>
        <li>本次活動將申請公務人員終身學習時數，請於休息時間簽到。</li>
        <li>為尊重智慧財產權，本論壇禁止側錄主講人簡報。</li>
        <li>本次課程場地配置圖請參考下圖。</li>
        <li>
            {% if url_for is defined %}
            <img src="{{ url_for('static', filename='802.png') }}" alt="場地圖" width="500" height="600">
            {% else %}
            <img src="{{ assets.static_prefix | default('') }}802.png" alt="場地圖" width="500" height="600">
            {% endif %}
        </li>
    </ul>
</section>
{% endif %}

{% if section in ['all', 'schedule'] %}
<section class="page-full">
    <h2>議程 / Schedule</h2>
    <hr class="section-sep">
    <table class="schedule" role="table" aria-label="議程表">
        <colgroup>
            <col style="width:3.0cm;">
            <col style="width:10.8cm;">
            <col style="width:3.6cm;">
        </colgroup>
        <thead>
        <tr>
            <th>時間 / Time</th>
            <th>主題 / Topic</th>
            <th>講者 / Speaker</th>
        </tr>
        </thead>
        <tbody>
        {% for row in schedule %}
        <tr>
            {% if row.type == 'break' %}
            <td>{{ row.time }}</td>
            <td colspan="2">{{ row.content }}</td>
            {% elif row.type == 'host' %}
            <td colspan="3" style="text-align:center; background-color:#FBE4D5;">{{ row.content }}</td>
            {% else %}
            <td>{{ row.time }}</td>
            <td>{{ row.topic }}</td>
            <td>{{ row.speaker }}</td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
</section>
{% endif %}

{% if section in ['all', 'chairs'] %}
{% if chairs %}
<section class="page-full">
    <h2>主持人 / Chairs</h2>
    <hr class="section-sep">
    <ul class="person-list">
        {% for chair in chairs %}
        <li>
            {{ chair.name }}{% if chair.title %} {{ chair.title }}{% endif %}
            {% if chair.organization %}<br>{{ chair.organization }}{% endif %}
        </li>
        {% endfor %}
    </ul>
</section>
{% endif %}

{% for chair in chairs %}
<section class="page-full" aria-label="主持人 Chair">
    <h2>主持人 / Chair</h2>
    <hr class="section-sep">
    <div class="person-card">
        {% if chair.photo_url %}
        <div class="person-photo"><img src="{{ chair.photo_url }}" style="width:100%; height:auto;"></div>
        {% elif url_for is defined %}
        {% set fallback = chair.name ~ '.png' %}
        <div class="person-photo"><img src="{{ url_for('static', filename=fallback) }}" style="width:100%; height:auto;"></div>
        {% endif %}
        <div class="person-info">
            <div class="name-title">{{ chair.name }}{% if chair.title %} {{ chair.title }}{% endif %}</div>
            {% if chair.organization %}<div class="organization">{{ chair.organization }}</div>{% endif %}
            {% if chair.highest_education %}<h3>學歷</h3><div class="section-content">{{ chair.highest_education }}</div>{% endif %}
            {% if chair.experience %}
            <h3>經歷</h3>
            <ul class="section-content">{% for item in chair.experience %}<li>{{ item }}</li>{% endfor %}</ul>
            {% endif %}
            {% if chair.achievements %}
            <h3>成就</h3>
            <ul class="section-content">{% for item in chair.achievements %}<li>{{ item }}</li>{% endfor %}</ul>
            {% endif %}
        </div>
    </div>
</section>
{% endfor %}
{% endif %}

{% if section in ['all', 'speakers'] %}
{% if speakers %}
<section class="page-full">
    <h2>講者 / Speakers</h2>
    <hr class="section-sep">
    <ul class="person-list">
        {% for sp in speakers %}
        <li>
            {{ sp.name }}{% if sp.title %} {{ sp.title }}{% endif %}
            {% if sp.organization %}<br>{{ sp.organization }}{% endif %}
        </li>
        {% endfor %}
    </ul>
</section>
{% endif %}

{% for sp in speakers %}
<section class="page-full" aria-label="講者 Speaker">
    <h2>講者 / Speaker</h2>
    <hr class="section-sep">
    <div class="person-card">
        {% if sp.photo_url %}
        <div class="person-photo"><img src="{{ sp.photo_url }}" style="width:100%; height:auto;"></div>
        {% elif url_for is defined %}
        {% set fallback = sp.name ~ '.png' %}
        <div class="person-photo"><img src="{{ url_for('static', filename=fallback) }}" style="width:100%; height:auto;"></div>
        {% endif %}
        <div class="person-info">
            <div class="name-title">{{ sp.name }}{% if sp.title %} {{ sp.title }}{% endif %}</div>
            {% if sp.organization %}<div class="organization">{{ sp.organization }}</div>{% endif %}
            {% if sp.highest_education %}<h3>學歷</h3><div class="section-content">{{ sp.highest_education }}</div>{% endif %}
            {% if sp.experience %}
            <h3>經歷</h3>
            <ul class="section-content">{% for item in sp.experience %}<li>{{ item }}</li>{% endfor %}</ul>
            {% endif %}
            {% if sp.achievements %}
            <h3>成就</h3>
            <ul class="section-content">{% for item in sp.achievements %}<li>{{ item }}</li>{% endfor %}</ul>
            {% endif %}
        </div>
    </div>
</section>
{% endfor %}
{% endif %}

</body>

<script>
    (function(){
      const formatter = new Intl.DateTimeFormat('zh-TW', {
        year: 'numeric', month: '2-digit', day: '2-digit', weekday: 'long'
      });

      function parseDateAvoidTZ(s){
        if(!s) return null;
        s = String(s).trim();
        let m = s.match(/^(\d{4})[-\/](\d{1,2})[-\/](\d{1,2})$/);
        if(m) return new Date(Number(m[1]), Number(m[2]) - 1, Number(m[3]));
        m = s.match(/^(\d{4})(\d{2})(\d{2})$/);
        if(m) return new Date(Number(m[1]), Number(m[2]) - 1, Number(m[3]));
        const d = new Date(s);
        return isNaN(d) ? null : d;
      }

      document.querySelectorAll('.js-date').forEach(el=>{
        const raw = el.dataset.iso || el.textContent || '';
        const d = parseDateAvoidTZ(raw);
        if(!d) return;
        el.textContent = formatter.format(d);
      });
    })();
</script>
</html>
